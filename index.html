<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat + GeliÅŸmiÅŸ MahsuplaÅŸma</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h2 id="pageTitle">Chat & MahsuplaÅŸma</h2>

      <div class="auth-section">
        <button id="openSettlement" type="button" style="display:none;" class="primary">
          MahsuplaÅŸma (Yeni Sekme)
        </button>
        <button id="openChat" type="button" style="display:none;" class="primary">
          Chat (Yeni Sekme)
        </button>

        <button id="login" type="button" class="success">Google ile giriÅŸ</button>
        <button id="logout" type="button" style="display:none;" class="danger">Ã‡Ä±kÄ±ÅŸ</button>
        <div class="pill" id="status">GiriÅŸ bekleniyorâ€¦</div>
      </div>
    </div>

    <!-- CHAT VIEW -->
    <div class="chat" id="chatView" style="display:none;">
      <div class="msgs" id="msgs"></div>
      <form class="chatbar" id="chatForm">
        <input id="chatText" maxlength="1000" placeholder="Mesaj yazâ€¦" autocomplete="off" />
        <button id="sendChat" disabled>GÃ¶nder</button>
      </form>
    </div>

    <!-- SETTLEMENT VIEW -->
    <div class="settlement-container" id="settlementView" style="display:none;">
      <!-- Add Expense Panel -->
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Yeni Harcama Ekle</div>
            <div class="panel-subtitle">Ortak harcamalarÄ± kaydedin ve takip edin</div>
          </div>
        </div>
        <div class="panel-body">
          <div class="grid-responsive">
            <div class="field">
              <label for="stTitle">Harcama BaÅŸlÄ±ÄŸÄ± *</label>
              <input id="stTitle" placeholder="Ã–rn: AkÅŸam YemeÄŸi, Market AlÄ±ÅŸveriÅŸi" maxlength="80" />
            </div>
            <div class="field">
              <label for="stAmount">Tutar *</label>
              <div class="flex-row">
                <input id="stAmount" type="number" inputmode="decimal" placeholder="Ã–rn: 1250" style="flex: 1;" />
                <select id="stCurrency" style="width: 100px;">
                  <option value="TRY">â‚º TRY</option>
                  <option value="USD">$ USD</option>
                  <option value="EUR">â‚¬ EUR</option>
                </select>
              </div>
            </div>
          </div>

          <div class="grid-responsive">
            <div class="field">
              <label for="stDate">Tarih</label>
              <input id="stDate" type="date" />
            </div>
            <div class="field">
              <label>Harcama TÃ¼rÃ¼</label>
              <select id="stCategory">
                <option value="yemek">ğŸ½ï¸ Yemek</option>
                <option value="market">ğŸ›’ Market</option>
                <option value="ulasim">ğŸš— UlaÅŸÄ±m</option>
                <option value="eglence">ğŸ‰ EÄŸlence</option>
                <option value="konaklama">ğŸ¨ Konaklama</option>
                <option value="diger">ğŸ“¦ DiÄŸer</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label for="stNote">AÃ§Ä±klama / Notlar</label>
            <textarea id="stNote" placeholder="Detaylar, Ã¶zel notlar, vs."></textarea>
          </div>

          <!-- Participants Selection -->
          <div class="participants-section">
            <label>KatÄ±lÄ±mcÄ±lar *</label>
            <div class="hint mb-2">KatÄ±lÄ±mcÄ±larÄ± seÃ§in</div>
            <div id="participantsContainer" class="participants-grid"></div>

            <div class="field mt-2">
              <label for="payerSelect">Ã–deyen KiÅŸi *</label>
              <select id="payerSelect">
                <option value="">â€” SeÃ§ â€”</option>
              </select>
              <div class="hint">Ã–deyen kiÅŸi listeden seÃ§ilir (mobil uyumlu)</div>
            </div>

            <div class="flex-row mt-2">
              <button type="button" id="selectAllParticipants">Hepsini SeÃ§</button>
              <button type="button" id="clearSelection">SeÃ§imi Temizle</button>
              <div class="pill" id="selectedCount">0 katÄ±lÄ±mcÄ± seÃ§ildi</div>
            </div>
          </div>

          <div class="field">
            <label>Manuel KatÄ±lÄ±mcÄ± Ekle (opsiyonel)</label>
            <div class="flex-row">
              <input id="stManualName" placeholder="Listede yoksa isim girin" maxlength="60" />
              <button type="button" id="addManualParticipant">Ekle</button>
            </div>
            <div class="hint">Bu kiÅŸi sadece bu harcama iÃ§in eklenecek</div>
          </div>

          <div class="flex-row">
            <button id="saveExpense" type="button" disabled class="primary">HarcamayÄ± Kaydet</button>
            <button id="clearForm" type="button">Formu Temizle</button>
            <div class="pill" id="stStatus">HazÄ±r</div>
          </div>
        </div>
      </div>

      <!-- Expenses List -->
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Harcama GeÃ§miÅŸi</div>
            <div class="panel-subtitle" id="expensesCount">0 harcama bulundu</div>
          </div>
          <div class="flex-row">
            <button id="refreshExpenses" type="button">Yenile</button>
            <select id="filterCategory">
              <option value="">TÃ¼m Kategoriler</option>
              <option value="yemek">Yemek</option>
              <option value="market">Market</option>
              <option value="ulasim">UlaÅŸÄ±m</option>
              <option value="eglence">EÄŸlence</option>
              <option value="konaklama">Konaklama</option>
              <option value="diger">DiÄŸer</option>
            </select>
          </div>
        </div>
        <div class="panel-body">
          <div id="expensesList" class="expenses-list">
            <!-- Expenses will be loaded here -->
          </div>
        </div>
      </div>

      <!-- Settlement Summary -->
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">MahsuplaÅŸma Ã–zeti</div>
            <div class="panel-subtitle">Kim ne kadar Ã¶dedi, kim ne kadar borÃ§lu</div>
          </div>
          <button id="calculateSettlement" type="button" class="success">Hesapla</button>
        </div>
        <div class="panel-body">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-label">Toplam Harcama</div>
              <div class="stat-value" id="totalExpense">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Harcama SayÄ±sÄ±</div>
              <div class="stat-value" id="expenseCount">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">KatÄ±lÄ±mcÄ± SayÄ±sÄ±</div>
              <div class="stat-value" id="participantCount">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">KiÅŸi BaÅŸÄ± Ortalama</div>
              <div class="stat-value" id="averagePerPerson">0</div>
            </div>
          </div>

          <div class="settlement-stats mt-2">
            <div style="font-weight: 600; margin-bottom: 12px;">BorÃ§/Alacak Durumu</div>
            <div id="balanceTableContainer">
              <!-- Balance table will be loaded here -->
              <div class="text-center" style="opacity: 0.7; padding: 20px;">
                Hesaplamak iÃ§in "Hesapla" butonuna tÄ±klayÄ±n
              </div>
            </div>
          </div>

          <div class="flex-row mt-2">
            <button id="exportData" type="button">Veriyi DÄ±ÅŸa Aktar</button>
            <button id="sendSummary" type="button">Ã–zeti Chat'e GÃ¶nder</button>
          </div>
        </div>
      </div>

      <!-- Back to Chat Button (for mobile) -->
      <div class="flex-row full-width mt-2">
        <button id="backToChatLocal" type="button" class="full-width">Chat'e DÃ¶n</button>
      </div>
    </div>
  </div>

  <!-- Expense Detail Modal -->
  <div id="expenseModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <div class="panel-title">Harcama DetayÄ±</div>
        <button type="button" id="closeModal">âœ•</button>
      </div>
      <div class="modal-body">
        <div id="expenseDetailContent">
          <!-- Expense details will be loaded here -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="editExpense">DÃ¼zenle</button>
        <button type="button" id="deleteExpense" class="danger">Sil</button>
        <button type="button" id="closeModal2">Kapat</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module" src="app.js"></script>
</body>
</html>